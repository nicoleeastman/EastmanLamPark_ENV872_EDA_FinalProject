---
title: "Sea Level and Water Temperature Data Analyses in Coastal North Carolina"
author: "Nicole Eastman, Ariel Lam, and Jiyoung Park"
date: "December 14, 2022"
output: pdf_document
geometry: margin=2.54cm
---
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Set your working directory
setwd("~R/EDA_Final")
getwd()

# Load your packages
library(tidyverse)
library(dplyr)
#install.packages("plyr")
library(plyr)
library(lubridate)
library(stringr)
library(readr)
library(zoo)
library(ggplot2)
library(Kendall)
library(gridExtra)
#install.packages("ggcorrplot")
library(ggcorrplot)

# Set your ggplot theme
mytheme <- theme_classic(base_size = 14) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "top")
theme_set(mytheme)

# Load your datasets
#Import Beaufort datasets
Beaufort_SeaLevel <- read_csv("Data/Raw_Data/SeaLevelData/Beaufort_Marine_Lab_2010_2022_SeaLevelRise.csv")

header <- scan ("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2010.csv", nlines = 1,sep=",", what =character())
beaufort11 = read.csv( "./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2011.csv",sep = ",", header = F, skip=2)
beaufort12 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2012.csv",sep = ",", header = F, skip=2)
beaufort13 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2013.csv",sep = ",", header = F, skip=2)
beaufort14 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2014.csv",sep = ",", header = F, skip=2) 
beaufort15 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2015.csv",sep = ",", header = F, skip=2)
beaufort16 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2016.csv",sep = ",", header = F, skip=2)
beaufort17 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2017.csv",sep = ",", header = F, skip=2)
beaufort18 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2018.csv",sep = ",", header = F, skip=2)
beaufort19 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2019.csv",sep = ",", header = F, skip=2)
beaufort20 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2020.csv",sep = ",", header = F, skip=2)
beaufort21 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2021.csv",sep = ",", header = F, skip=2)

#Import Hatteras Datasets
Hatteras_SeaLevel<- read_csv("Data/Raw_Data/SeaLevelData/Hatteras_2010_2022_SeaLevelRise.csv")

header <- scan ("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2010.csv", nlines = 1,sep=",", what =character())
Hatteras11 = read.csv( "./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2011.csv",sep = ",", header = F, skip=2)
Hatteras12 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2012.csv",sep = ",", header = F, skip=2)
Hatteras13 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2013.csv",sep = ",", header = F, skip=2)
Hatteras14 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2014.csv",sep = ",", header = F, skip=2) 
Hatteras15 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2015.csv",sep = ",", header = F, skip=2)
Hatteras16 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2016.csv",sep = ",", header = F, skip=2)
Hatteras17 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2017.csv",sep = ",", header = F, skip=2)
Hatteras18 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2018.csv",sep = ",", header = F, skip=2)
Hatteras19 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2019.csv",sep = ",", header = F, skip=2)
Hatteras20 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2020.csv",sep = ",", header = F, skip=2)
Hatteras21 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2021.csv",sep = ",", header = F, skip=2)

#Import Wrightsville Datasets
Wrightsville_SeaLevel<- read_csv("Data/Raw_Data/SeaLevelData/WrightsvilleBeach_2010_2022_SeaLevelRise.csv")

header <- scan ("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2010.csv", nlines = 1,sep=",", what =character())
Wrightsville11 = read.csv( "./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2011.csv",sep = ",", header = F, skip=2)
Wrightsville12 = read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2012.csv",sep = ",", header = F, skip=2)
Wrightsville13 = read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2013.csv",sep = ",", header = F, skip=2)
Wrightsville14 = read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2014.csv",sep = ",", header = F, skip=2) 
Wrightsville15 = read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2015.csv",sep = ",", header = F, skip=2)
Wrightsville16 = read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2016.csv",sep = ",", header = F, skip=2)
Wrightsville17 = read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2017.csv",sep = ",", header = F, skip=2)
Wrightsville18 = read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2018.csv",sep = ",", header = F, skip=2)
Wrightsville19 = read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2019.csv",sep = ",", header = F, skip=2)
Wrightsville20 = read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2020.csv",sep = ",", header = F, skip=2)
Wrightsville21 = read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2021.csv",sep = ",", header = F, skip=2)
```


# Rationale and Research Questions
Do climate change indicators, sea level and water temperature have specific time series trends and do they have a statistically significant relationship at three coastal sites in North Carolina: Beaufort, Cape Hatteras, and Wrightsville Beach?

\newpage

# Dataset Information
We are using this repository to upload data from NOAA's Tides & Currents Datasets for sea level measurements and NOAA's National Data Buoy Center for water temperature measurements. We are looking at monthly data for water temperature and sea level at three different coastal sites: Beaufort Marine Lab, Hatteras Island, and Wrightsville Beach. Sea level and water temperature were the chosen parameters to assess because they are indicators of climate change, and we want to analyze the changes occuring on the coast of North Carolina due to climate change. The data begins on the first day of 2011 and ends on November 31, 2022. This project will use a time series analysis to identify seasonal trends and changes in sea level and water temperature over the past 12 years using a Mann Kendall test. We will then identify if there is a statistical relationship between the two parameters using a Kendall correlation test.

```{r}
# Wrangle data to combine the water temperature data for each year into one csv for each site
Beaufort.Water.Temp <-rbind(beaufort11,beaufort12,beaufort13,beaufort14,beaufort15, beaufort16, beaufort17, beaufort18, beaufort19, beaufort20,beaufort21)
names (Beaufort.Water.Temp) <- header

Hatteras.Water.Temp <-rbind(Hatteras11,Hatteras12,Hatteras13,Hatteras14,Hatteras15, Hatteras16, Hatteras17, Hatteras18, Hatteras19, Hatteras20,Hatteras21)
names (Hatteras.Water.Temp) <- header

Wrightsville.Water.Temp <-rbind(Wrightsville11,Wrightsville12,Wrightsville13,Wrightsville14,Wrightsville15, Wrightsville16, Wrightsville17, Wrightsville18, Wrightsville19, Wrightsville20,Wrightsville21)
names (Wrightsville.Water.Temp) <- header
```

```{r}
#clean-up data that has inconsistent values 
#random values of 999 were included from the original data 

Beaufort.Water.Temp <- Beaufort.Water.Temp %>% 
  mutate (WTMP=ifelse(WTMP ==999,NA,WTMP)) %>% 
  mutate(WTMP = zoo::na.approx(WTMP))

Hatteras.Water.Temp <- Hatteras.Water.Temp %>% 
  mutate (WTMP=ifelse(WTMP ==999,NA,WTMP)) %>% 
  mutate(WTMP = zoo::na.approx(WTMP))

Wrightsville.Water.Temp <- Wrightsville.Water.Temp %>% 
  mutate (WTMP=ifelse(WTMP ==999,NA,WTMP)) %>% 
  mutate(WTMP = zoo::na.approx(WTMP))
```



```{r}
#Wrangle Beaufort water temperature data frames to be averaged by month
beaufort_wtmp <- Beaufort.Water.Temp %>% 
  select("#YY","MM","DD","WTMP") %>% 
  dplyr::rename(Year = "#YY", Month = "MM", Day ="DD") %>% 
  mutate("Date" = make_date(year= Year, month =Month, day = Day))

beaufort_daily_wtmp <-  beaufort_wtmp %>% 
  dplyr::group_by(Year, Month, Day, Date) %>% 
  dplyr::summarise(dailywtmp = mean(WTMP),.groups ='drop') %>% 
  mutate(Station = "Beaufort")

beaufort_monthly_wtmp <- beaufort_wtmp %>% 
  dplyr::group_by(Year, Month) %>% 
  dplyr::summarise( monthlywtmp = mean(WTMP), .groups ='drop') %>% 
  mutate(Station = "Beaufort")%>% 
  mutate("Date" = make_date(year= Year, month = Month))

#Wrangle Hatteras water temperature dataframe to be averaged by month
Hatteras_wtmp <- Hatteras.Water.Temp %>% 
  select("#YY","MM","DD","WTMP") %>% 
  dplyr::rename (Year = "#YY", Month = "MM", Day ="DD")  %>% 
  mutate("Date" = make_date(year= Year, month =Month, day = Day))

Hatteras_daily_wtmp <-  Hatteras_wtmp %>% 
  dplyr::group_by(Year, Month, Day, Date) %>% 
  dplyr::summarise(dailywtmp = mean(WTMP),.groups ='drop') %>% mutate(Station = "Hatteras")

Hatteras_monthly_wtmp <- Hatteras_wtmp %>% 
  dplyr::group_by(Year, Month) %>% 
  dplyr::summarise( monthlywtmp = mean(WTMP), .groups ='drop') %>% 
  mutate(Station = "Hatteras")%>% 
  mutate("Date" = make_date(year= Year, month = Month))


#Wrangle Wrightsville water temperature data frame to be averaged by month

Wrightsville_wtmp <- Wrightsville.Water.Temp %>% 
  select("#YY","MM","DD","WTMP") %>% 
  dplyr::rename (Year = "#YY", Month = "MM", Day ="DD") %>% 
  mutate("Date" = make_date(year= Year, month =Month, day = Day))

Wrightsville_daily_wtmp <-  Wrightsville_wtmp %>% 
  dplyr::group_by(Year, Month, Day, Date) %>% 
  dplyr::summarise(dailywtmp = mean(WTMP),.groups ='drop') %>% 
  mutate(Station = "Wrightsville")

Wrightsville_monthly_wtmp <- Wrightsville_wtmp %>% 
  dplyr::group_by(Year, Month) %>% 
  dplyr::summarise( monthlywtmp = mean(WTMP), .groups ='drop') %>% 
  mutate(Station = "Wrightsville") %>% 
  mutate("Date" = make_date(year= Year, month = Month))

```

```{r}
#combine daily datasets for water temperature 

combine_daily_water_temp <- rbind (beaufort_daily_wtmp, Hatteras_daily_wtmp, Wrightsville_daily_wtmp)
write.csv(combine_daily_water_temp, './Data/Processed_Data/combine_daily_water_temp.csv')

#combine monthly datasets for water temperature 

combine_monthly_water_temp <- rbind (beaufort_monthly_wtmp, Hatteras_monthly_wtmp, Wrightsville_monthly_wtmp)
write.csv(combine_monthly_water_temp, './Data/Processed_Data/combine_monthly_water_temp.csv')

```

```{r}
#clean-up sea level datasets
Beaufort_SeaLevel <- Beaufort_SeaLevel %>% select(c(1,6,7)) %>% mutate(Station= "Beaufort")
Hatteras_SeaLevel$Date <- as.Date(Hatteras_SeaLevel$Date, format = "%m/%d/%y")
Hatteras_SeaLevel <- Hatteras_SeaLevel %>% select(c(1,6,7)) %>% mutate(Station= "Hatteras")
Wrightsville_SeaLevel <-Wrightsville_SeaLevel %>% select(c(1,6,7)) %>% mutate(Station= "Wrightsville")

combine_sealevel <- rbind (Beaufort_SeaLevel, Hatteras_SeaLevel, Wrightsville_SeaLevel)
write.csv(combine_sealevel, './Data/Processed_Data/combine_sealevel.csv')

#Prepare necessary data frames for the analyses

combined_sea_level_data <- read.csv("./Data/Processed_Data/combine_sealevel.csv")
#Add month-year column from date
combined_sea_level_data$Date<- as.Date(combined_sea_level_data$Date)
combined_sea_level_data <- combined_sea_level_data %>% mutate(Month=month(Date)) %>% mutate(Year=year(Date)) %>% group_by(Year, Month) 

combined_water_temp_data<- read.csv("./Data/Processed_Data/combine_monthly_water_temp.csv")
combined_water_temp_data$Date <-as.yearmon(paste(combined_water_temp_data$Year, combined_water_temp_data$Month, sep="-"), "%Y-%m")
```

\newpage

# Exploratory Analysis 
```{r, fig.cap="Sea Level Trend Exploration", fig.align='left', fig.height= 2.5}
#Exploring sea level measurements over the 12 years

sea_level_plot <- ggplot(combined_sea_level_data, aes(x=Date, y=MSL..ft., group = Station))+ geom_line(aes(color = Station)) + geom_smooth(method= "lm", se=FALSE) +
    labs(title = "Mean Sea Levels (2010-2022)",
        y = "Mean Sea Level (ft)", x = "Date (Month-Year)") + 
  scale_x_date(date_breaks="18 months", date_labels ="%b-%y")
print(sea_level_plot)

tide_level <- ggplot(combined_sea_level_data, aes(x=Date, y=MTL..ft., group = Station))+geom_line(aes(color = Station)) + geom_smooth(method= "lm", se=FALSE) +
    labs(title = "Mean Tide Levels (2010-2022)",
        y = "Mean Tide (ft) Level", x = "Date")
print(tide_level)


#Sea Level Measurements for 2011 and 2021

sea_level_2011 <- ggplot(combined_sea_level_data, aes(x=Date, y=MSL..ft., group = Station))+geom_line(aes(color = Station)) + geom_smooth(method= "lm", se=FALSE) +
    labs(title = "Mean Sea Levels (2011)",
        y = "Mean Sea Level (ft)", x = "Date (Month-Year)") +
  scale_x_date(limits= as.Date(c("2011-01-01", "2011-12-01")), date_breaks="2 months", date_labels ="%b-%y")
print(sea_level_2011)

sea_level_2021 <- ggplot(combined_sea_level_data, aes(x=Date, y=MSL..ft., group = Station))+geom_line(aes(color = Station)) + geom_smooth(method= "lm", se=FALSE) +
    labs(title = "Mean Sea Levels (2011)",
        y = "Mean Sea Level (ft)", x = "Date (Month-Year)") +
  scale_x_date(limits= as.Date(c("2021-01-01", "2021-12-01")), date_breaks="2 months", date_labels ="%b-%y")
print(sea_level_2021)

combined_2011_2021<- grid.arrange(sea_level_2011, sea_level_2021, ncol= 2, common.ledgend= TRUE)
print(combined_2011_2021)
```

```{r, fig.cap="Water Temperature Trend Exploration", fig.align='left', fig.height= 2.5}
#Exploring Trends in Water Temperature

#Daily Water Temperature Measurements for 2011-2022
combined_daily_wtmp_data <- read.csv("./Data/Processed_Data/combine_daily_water_temp.csv")
combined_daily_wtmp_data$Date<-as.Date(combined_daily_wtmp_data$Date, format = "%Y-%m-%d")
daily_wtmp_level_plot <-ggplot(combined_daily_wtmp_data, aes(x =Date, y=dailywtmp,group= Station))+
  geom_line(aes(color=Station))+
  labs(title = "Daily Water Temperature (2011-2022)", y= "Daily Water Temp (Celcius)", x= "Date")+
  scale_x_date(date_breaks = "6 months", date_labels = "%Y-%m-%d")+
  theme(axis.text.x = element_text(angle=60, hjust=1))
print(daily_wtmp_level_plot)

#Monthly Water Temperature Measurements for 2011-2022
combined_monthly_wtmp_data <- read.csv("./Data/Processed_Data/combine_monthly_water_temp.csv")
combined_monthly_wtmp_data$Date<-as.Date(combined_monthly_wtmp_data$Date, format = "%Y-%m-%d")
monthly_wtmp_level_plot <-ggplot(combined_monthly_wtmp_data, aes(x =Date, y=monthlywtmp,group= Station))+
  geom_line(aes(color=Station))+
  labs(title = "Monthly Water Temperature (2011-2022)", y= "Monthly Water Temp (Celcius)", x= "Date")+
  scale_x_date(date_breaks = "6 months", date_labels = "%Y-%m")+
  theme(axis.text.x = element_text(angle=60, hjust=1))
print(monthly_wtmp_level_plot)

```
\newpage

# Analysis

```{r,fig.cap="Beaufort Sea Level Timeseries", fig.align='left', fig.height= 2.5}
#Beaufort Sea Level Time Series
Beaufort <- combined_sea_level_data %>% filter(Station == "Beaufort")

Beaufort.monthly.ts <- ts(Beaufort$MSL..ft.,
    start = c(2010, 1), frequency = 12)

Beaufort_Monthly_Sea_Level <- stl(Beaufort.monthly.ts,
    s.window = "periodic")

plot(Beaufort_Monthly_Sea_Level)

Beaufort_monthly_sea_level_monotonic_trend_analysis <- Kendall::SeasonalMannKendall(Beaufort.monthly.ts)

summary(Beaufort_monthly_sea_level_monotonic_trend_analysis)

Beaufort_monthly_sea_level_monotonic_trend_analysis_no_szn <- Beaufort.monthly.ts - Beaufort_Monthly_Sea_Level$time.series[,1]

Beaufort_monthly_sea_level_no_szn_trend <- MannKendall(Beaufort_monthly_sea_level_monotonic_trend_analysis_no_szn)

summary(Beaufort_monthly_sea_level_no_szn_trend)

```
 
```{r,fig.cap="Hatteras Sea Level Timeseries", fig.align='left', fig.height= 2.5}
#Hatteras Sea Level Time Series
Hatteras <- combined_sea_level_data %>% filter(Station == "Hatteras")

Hatteras.monthly.ts <- ts(Hatteras$MSL..ft.,
    start = c(2010, 1), frequency = 12)

Hatteras_Monthly_Sea_Level <- stl(Hatteras.monthly.ts,
    s.window = "periodic")

plot(Hatteras_Monthly_Sea_Level)

Hatteras_monthly_sea_level_monotonic_trend_analysis <- Kendall::SeasonalMannKendall(Hatteras.monthly.ts)
summary(Hatteras_monthly_sea_level_monotonic_trend_analysis)

Hatteras_monthly_sea_level_monotonic_trend_analysis_no_szn <- Hatteras.monthly.ts - Hatteras_Monthly_Sea_Level$time.series[,1]

Hatteras_monthly_sea_level_no_szn_trend <- MannKendall(Hatteras_monthly_sea_level_monotonic_trend_analysis_no_szn)

summary(Hatteras_monthly_sea_level_no_szn_trend)

```

```{r, fig.cap="Wrightsville Sea Level Timeseries", fig.align='left', fig.height= 2.5}
#Wrightsville Sea Level Time Series
Wrightsville <- combined_sea_level_data %>% filter(Station == "Wrightsville")

Wrightsville.monthly.ts <- ts(Wrightsville$MSL..ft.,
    start = c(2010, 1), frequency = 12)

Wrightsville_Monthly_Sea_Level <- stl(Wrightsville.monthly.ts,
    s.window = "periodic")

plot(Wrightsville_Monthly_Sea_Level)

Wrightsville_monthly_sea_level_monotonic_trend_analysis <- Kendall::SeasonalMannKendall(Wrightsville.monthly.ts)

summary(Wrightsville_monthly_sea_level_monotonic_trend_analysis)


Wrightsville_monthly_sea_level_monotonic_trend_analysis_no_szn <- Wrightsville.monthly.ts - Wrightsville_Monthly_Sea_Level$time.series[,1]

Wrightsville_monthly_sea_level_no_szn_trend <- MannKendall(Wrightsville_monthly_sea_level_monotonic_trend_analysis_no_szn)

summary(Wrightsville_monthly_sea_level_no_szn_trend)
```

```{r, fig.cap="Beaufort Water Temperature Timeseries", fig.align='left', fig.height= 2.5}
#Beaufort Water Temperature Time Series
Beaufort_water_temp_filter <- combined_water_temp_data %>% filter(Station == "Beaufort")

Beaufort.temp.monthly.ts <- ts(Beaufort_water_temp_filter$monthlywtmp,
    start = c(2011, 1), frequency = 12)


Beaufort_Monthly_WaterTemp <- stl(Beaufort.temp.monthly.ts,
    s.window = "periodic")

plot(Beaufort_Monthly_WaterTemp)

Beaufort_monthly_wtmp_monotonic_trend_analysis <- Kendall::SeasonalMannKendall(Beaufort.temp.monthly.ts)
summary(Beaufort_monthly_wtmp_monotonic_trend_analysis)

Beaufort_monthly_wtmp_monotonic_trend_analysis_no_szn <- Beaufort.temp.monthly.ts - Beaufort_Monthly_WaterTemp$time.series[,1]

Beaufort_monthly_wtmp_no_szn_trend <- MannKendall(Beaufort_monthly_wtmp_monotonic_trend_analysis_no_szn)

summary(Beaufort_monthly_wtmp_no_szn_trend)
```

```{r, fig.cap="Hatteras Water Temperature Timeseries", fig.align='left', fig.height= 2.5}
#Hatteras Water Temperature Time Series

Hatteras_water_temp_filter <- combined_water_temp_data %>% filter(Station == "Hatteras")

Hatteras.temp.monthly.ts <- ts(Hatteras_water_temp_filter$monthlywtmp,
    start = c(2011, 1), frequency = 12)


Hatteras_Monthly_WaterTemp <- stl(Hatteras.temp.monthly.ts,
    s.window = "periodic")

plot(Hatteras_Monthly_WaterTemp)

Hatteras_monthly_wtmp_monotonic_trend_analysis <- Kendall::SeasonalMannKendall(Hatteras.temp.monthly.ts)
summary(Hatteras_monthly_wtmp_monotonic_trend_analysis)

Hatteras_monthly_wtmp_monotonic_trend_analysis_no_szn <- Hatteras.temp.monthly.ts - Hatteras_Monthly_WaterTemp$time.series[,1]

Hatteras_monthly_wtmp_no_szn_trend <- MannKendall(Hatteras_monthly_wtmp_monotonic_trend_analysis_no_szn)

summary(Hatteras_monthly_wtmp_no_szn_trend)

```

```{r, fig.cap="Wrightsville Water Temperature Timeseries", fig.align='left', fig.height= 2.5}
#Wrightsville Water Temperature Time Series
Wrightsville_water_temp_filter <- combined_water_temp_data %>% filter(Station == "Wrightsville")

Wrightsville.temp.monthly.ts <- ts(Wrightsville_water_temp_filter$monthlywtmp,
    start = c(2011, 1), frequency = 12)


Wrightsville_Monthly_WaterTemp <- stl(Wrightsville.temp.monthly.ts,
    s.window = "periodic")

plot(Wrightsville_Monthly_WaterTemp)

Wrightsville_monthly_wtmp_monotonic_trend_analysis <- Kendall::SeasonalMannKendall(Wrightsville.temp.monthly.ts)
summary(Wrightsville_monthly_wtmp_monotonic_trend_analysis)

Wrightsville_monthly_wtmp_monotonic_trend_analysis_no_szn <- Wrightsville.temp.monthly.ts - Wrightsville_Monthly_WaterTemp$time.series[,1]

Wrightsville_monthly_wtmp_no_szn_trend <- MannKendall(Wrightsville_monthly_wtmp_monotonic_trend_analysis_no_szn)

summary(Wrightsville_monthly_wtmp_no_szn_trend)

```

```{r}
#Correlation Test Between Sea Level and Water Temperature

#Check normality of data
shapiro.test(combined_sea_level_data$MSL..ft.)
shapiro.test(combined_water_temp_data$monthlywtmp)
#The data is non-normal

#Complete a correlation test
combined.sea.level.correlation.edits<- combined_sea_level_data[-c(1,2,3,4,5,6,7,8,9,10,11,12,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,290,291,292,293,294,295,296,297,298,299,300,301,427,428,429,430,431,432,433,434,435,436),]
combined.sea.level.correlation.final <- combined.sea.level.correlation.edits[-c(427,428,429,430,431,432,433,434,435,436),]
combined.water.temp.correlation.edits<- combined_water_temp_data[-c(152,163,164,262,263,273,279,294,359,360,361,362),]

Correlation.kendall<- cor.test(combined.sea.level.correlation.edits$MSL..ft., combined.water.temp.correlation.edits$monthlywtmp, method = "kendall")
Correlation.kendall

correlation.combined<- data.frame(combined.sea.level.correlation.edits[,3], combined.water.temp.correlation.edits[,4])
names(correlation.combined) <- c("MSL", "WTMP")
abline(lm(MSL~WTMP, data=correlation.combined))
cor(correlation.combined)

##Plot correlation
correlation.plot<- ggcorrplot(Correlation.kendall)
```
## Question 1: How have sea level trends and water temperature trends changed over time and how has seasonality played role at three coastal North Carolina sites: Beaufort, NC, 

## Question 2: Is there a stastically significant relationship between sea level and water temperature?




\newpage

# Summary and Conclusions

##Sea Level Time Series Analyses Conclusions
From the Beaufort sea level time series plots, it appears that the trend does appear to be gradually increasing over time with a couple of fluctuations. Therefore, both a non-seasonal and a seasonal Mann Kendall analysis should be run in order to see clearer quantified trends. Mann Kendall has the ability to detect accept or reject the presence of monotomic trends. When the seasonal Mann Kendall was ran, the score was 407 with a tau of 0.447 and a statistically significant 2-sided p-value of 2.94e^-13. The statistical significant value underscores that the data has a monotonic trend. The positive value of tau signifies an increasing trend. The seasonal Mann Kendall test only compares data values of the same season. When the seasonal component was removed, the score increased to 4862, with a  tau of 0.413, and an even smaller 2-sided p-value of 2.22e-16. The positive value of tau signifies an increasing trend.Based on the fact that both tests suggest there is an increasing trend, we can tentatively state that the sea levels of Beaufort are generally increasing over time.

From the Hatteras sea level time series plots, it appears that the overall data trend in sea level rise is increasing over time. Therefore, both a non-seasonal and a seasonal Mann Kendall analysis should be run in order to see clearer quantified trends. When the seasonal Mann Kendall was ran, the score was 216 with a tau of 0.274 and a statistically significant 2-sided p-value of 1.86e^-5. The statistical significant value underscores that the data has a monotonic trend. The positive value of tau signifies an increasing trend. The seasonal Mann Kendall test only compares data values of the same season. When the seasonal component was removed, the score increased to 2806, with a  tau of 0.273, and an even smaller 2-sided p-value of 1.31e-6. The positive value of tau signifies an increasing trend.Based on the fact that both tests suggest there is an increasing trend, we can tentatively state that the sea levels of Hatteras are generally increasing over time. 

From the Wrightsville sea level time series plots, it appears that the trend of sea level seems to be gradually increasing over time witha  couple of fluctuations. When the seasonal Mann Kendall was ran, the score was 175 with a tau of 0.242 and statistically significant 2-sided p-value of 0.0002. The statistical significant value underscores that the data has a monotonic trend. The positive value of tau signifies an increasing trend. The seasonal Mann Kendall test only compares data values of the same season. When the seasonal component was removed, the score increased to 2824, with a  tau of 0.299, and an even smaller 2-sided p-value of 2.38e-7. The positive value of tau signifies an increasing trend.Based on the fact that both tests suggest there is an increasing trend, we can tentatively state that the sea levels of Beaufort are generally increasing over time. 

##Water Temperature Time Series Analyses Conclusions
The Beaufort water temperature time series plot suggests an overall increasing trend in water temperature over time. The seasonal Mann Kendall test resulted in a score of 190, a tau value of 0.288 and significant p-value of 1.96 e-5, suggesting that a monotonic trend can be accepted and it shows a gradual increase in water temperature over time as tau is positive. Removal of seasonality resulted in a score of 1972, tau of .228, and less, but still statistically significant 2-sided pvalue of 0.0001 demonstrating that the removal of seasonality still highlights a monotonic trend in water temperature at the Beaufort site. Therefore we can tentatively say that water temperature is generally increasing over time. 

The Hatteras water temperature time series plot suggests a relatively random distribution of water temperature over time. The seasonal Mann Kendall test resulted in a score of 10, a tau value of 0.0152 and non-significant p-value of 0.82, suggesting that a monotonic trend must be rejected and therefore, there can be no conclusion drawn. Removal of seasonality resulted in a score of -54, tau of -0.00625, and also, a non-statistically significant 2-sided pvalue of 0.92 demonstrating that the removal of seasonality also rejects the presence of a monotonic trend in water temperature at the Hatteras site. Therefore we cannot say much about the change in water temperature over time at Hatteras. 

The Wrightsville water temperature time series plot suggests a relatively uniform, mildly fluctuating distribution of water temperature over time. The seasonal Mann Kendall test resulted in a score of 4, a tau value of 0.006 and non-significant p-value of 0.92, suggesting that a monotonic trend must be rejected and therefore, there can be no conclusion drawn. Removal of seasonality resulted in a score of 100, tau of 0.116, and also, a non-statistically significant 2-sided pvalue of 0.84 demonstrating that the removal of seasonality also rejects the presence of a monotonic trend in water temperature at the Hatteras site. Therefore we cannot say much about the change in water temperature over time at Wrightsville. 

#Correlation between Sea Level and Water Temperature Data
According to the Kendall's rank correlation test, the tau is equal to 0.1853611 which indicates there is a weak positive relationship between the two parameters. This means that there is a slight correlation that indicates when one value increases, the other will increases. The p-value is approximately 0 which means we reject the null hypothesis which states there is no association between sea levels and water temperature. 

A simple correlation test between the two variables finds a slightly stronger relationship with a correlation coefficient of 0.216857. This test also indicated a slightly positive correlation between sea level and water temperature at the three sites. 
\newpage

# References
<add references here if relevant, otherwise delete this section> 
