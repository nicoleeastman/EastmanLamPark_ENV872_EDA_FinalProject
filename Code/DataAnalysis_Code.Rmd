```{r}
#timeseries 

library(tidyverse)
library(dplyr)
library(plyr)
library(lubridate)
library(stringr)
library(readr)
library(zoo)

```

```{r}
#Import data
getwd()
#setwd("/Users/ariellam/Desktop/EDA-Fall2022/EastmanLamPark_ENV872_EDA_FinalProject/EastmanLamPark_ENV872_EDA_FinalProject")
setwd("~/EastmanLamPark_ENV872_EDA_FinalProject")


combined_sea_level_data <- read.csv("./Processed_Data/combine_sealevel.csv")
#Add month-year column from date
combined_sea_level_data$Date<- as.Date(combined_sea_level_data$Date)

combined_water_temp_data<- read.csv("./Processed_Data/combine_monthly_water_temp.csv")
combined_water_temp_data$Date <-as.yearmon(paste(combined_water_temp_data$Year, combined_water_temp_data$Month, sep="-"), "%Y-%m")

```

```{r}
#Beaufort Time Series
Beaufort <- combined_sea_level_data %>% filter(Station == "Beaufort")

Beaufort.monthly.ts <- ts(Beaufort$MSL..ft.,
    start = c(2010, 1), frequency = 12)


Beaufort_Monthly_Sea_Level <- stl(Beaufort.monthly.ts,
    s.window = "periodic")

plot(Beaufort_Monthly_Sea_Level)

Beaufort_monthly_sea_level_monotonic_trend_analysis <- Kendall::SeasonalMannKendall(Beaufort.monthly.ts)
summary(Beaufort_monthly_sea_level_monotonic_trend_analysis)

```

```{r}
#Hatteras Time Series
Hatteras <- combined_sea_level_data %>% filter(Station == "Hatteras")

Hatteras.monthly.ts <- ts(Hatteras$MSL..ft.,
    start = c(2010, 1), frequency = 12)

Hatteras_Monthly_Sea_Level <- stl(Hatteras.monthly.ts,
    s.window = "periodic")

plot(Hatteras_Monthly_Sea_Level)

Hatteras_monthly_sea_level_monotonic_trend_analysis <- Kendall::SeasonalMannKendall(Hatteras.monthly.ts)
summary(Hatteras_monthly_sea_level_monotonic_trend_analysis)

```

```{r}
#Wrightsville Time Series
Wrightsville <- combined_sea_level_data %>% filter(Station == "Wrightsville")

Wrightsville.monthly.ts <- ts(Wrightsville$MSL..ft.,
    start = c(2010, 1), frequency = 12)

Wrightsville_Monthly_Sea_Level <- stl(Wrightsville.monthly.ts,
    s.window = "periodic")

plot(Wrightsville_Monthly_Sea_Level)

Wrightsville_monthly_sea_level_monotonic_trend_analysis <- Kendall::SeasonalMannKendall(Wrightsville.monthly.ts)

summary(Wrightsville_monthly_sea_level_monotonic_trend_analysis)
```

```{r}
#Beaufort Water Temperature Time Series
```

```{r}
#Hatteras Water Temperature Time Series
```

```{r}
#Wrightsville Water Temperature Time Series
```

```{r}
#Correlation Test Between Sea Level and Water Temperature

#Check normality of data
shapiro.test(combined_sea_level_data$MSL..ft.)
shapiro.test(combined_water_temp_data$monthlywtmp)
#The data is non-normal

#Complete a correlation test
combined.sea.level.correlation.edits<- combined_sea_level_data[-c(1,2,3,4,5,6,7,8,9,10,11,12,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,290,291,292,293,294,295,296,297,298,299,300,301,427,428,429,430,431,432,433,434,435,436),]
combined.sea.level.correlation.final <- combined.sea.level.correlation.edits[-c(427,428,429,430,431,432,433,434,435,436),]
combined.water.temp.correlation.edits<- combined_water_temp_data[-c(152,163,164,262,263,273,279,294,359,360,361,362),]

Correlation.kendall<- cor.test(combined.sea.level.correlation.edits$MSL..ft., combined.water.temp.correlation.edits$monthlywtmp, method = "kendall")

```

