---
title: "Sea Level and Water Temperature Data Analyses in Coastal North Carolina"
author: "Nicole Eastman, Ariel Lam, and Jiyoung Park"
date: "December 14, 2022"
output: pdf_document
geometry: margin=2.54cm
---

\newpage
\tableofcontents 


\newpage
\listoftables 


\newpage
\listoffigures 



\newpage

```{r setup, include=FALSE}
#Global settings
knitr::opts_chunk$set

# Set your working directory
#setwd("~R/EDA_Final")
#setwd("~/EastmanLamPark_ENV872_EDA_FinalProject")
getwd()
# Load your packages
library(tidyverse)
library(dplyr)
#install.packages("plyr")
library(plyr)
library(lubridate)
library(stringr)
library(readr)
library(zoo)
library(ggplot2)
library(Kendall)
library(gridExtra)
#install.packages("ggcorrplot")
library(ggcorrplot)
library(formatR)



# Set your ggplot theme
mytheme <- theme_classic(base_size = 14) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "top")
theme_set(mytheme)

# Load your datasets
#Import Beaufort datasets
Beaufort_SeaLevel <-
  read_csv("Data/Raw_Data/SeaLevelData/Beaufort_Marine_Lab_2010_2022_SeaLevelRise.csv")
header <- scan ("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2010.csv", 
                nlines = 1,sep=",", what =character())
beaufort11 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2011.csv"
                       ,sep = ",", header = F, skip=2)
beaufort12 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2012.csv"
                      ,sep = ",", header = F, skip=2)
beaufort13 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2013.csv"
                      ,sep = ",", header = F, skip=2)
beaufort14 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2014.csv"
                      ,sep = ",", header = F, skip=2) 
beaufort15 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2015.csv"
                      ,sep = ",", header = F, skip=2)
beaufort16 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2016.csv"
                      ,sep = ",", header = F, skip=2)
beaufort17 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2017.csv"
                      ,sep = ",", header = F, skip=2)
beaufort18 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2018.csv"
                      ,sep = ",", header = F, skip=2)
beaufort19 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2019.csv"
                      ,sep = ",", header = F, skip=2)
beaufort20 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2020.csv"
                      ,sep = ",", header = F, skip=2)
beaufort21 = read.csv("./Data/Raw_Data/WaterTempData/Beaufort/beaufort_2021.csv"
                      ,sep = ",", header = F, skip=2)

#Import Hatteras Datasets
Hatteras_SeaLevel<- 
  read_csv("Data/Raw_Data/SeaLevelData/Hatteras_2010_2022_SeaLevelRise.csv")
header <- scan ("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2010.csv", 
                nlines = 1,sep=",", what =character())
Hatteras11 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2011.csv"
                      ,sep = ",", header = F, skip=2)
Hatteras12 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2012.csv"
                      ,sep = ",", header = F, skip=2)
Hatteras13 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2013.csv"
                      ,sep = ",", header = F, skip=2)
Hatteras14 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2014.csv"
                      ,sep = ",", header = F, skip=2) 
Hatteras15 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2015.csv"
                      ,sep = ",", header = F, skip=2)
Hatteras16 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2016.csv"
                      ,sep = ",", header = F, skip=2)
Hatteras17 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2017.csv"
                      ,sep = ",", header = F, skip=2)
Hatteras18 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2018.csv"
                      ,sep = ",", header = F, skip=2)
Hatteras19 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2019.csv"
                      ,sep = ",", header = F, skip=2)
Hatteras20 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2020.csv"
                      ,sep = ",", header = F, skip=2)
Hatteras21 = read.csv("./Data/Raw_Data/WaterTempData/Hatteras/Hatteras_2021.csv"
                      ,sep = ",", header = F, skip=2)

#Import Wrightsville Datasets
Wrightsville_SeaLevel<-
read_csv("Data/Raw_Data/SeaLevelData/WrightsvilleBeach_2010_2022_SeaLevelRise.csv")
header <- scan ("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2010.csv",
                nlines = 1,sep=",", what =character())
Wrightsville11 = 
  read.csv( "./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2011.csv"
                           ,sep = ",", header = F, skip=2)
Wrightsville12 = 
  read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2012.csv",
                          sep = ",", header = F, skip=2)
Wrightsville13 = 
  read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2013.csv",
           sep = ",", header = F, skip=2)
Wrightsville14 = 
  read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2014.csv",
         sep = ",", header = F, skip=2) 
Wrightsville15 = 
  read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2015.csv",
           sep = ",", header = F, skip=2)
Wrightsville16 = 
  read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2016.csv",
           sep = ",", header = F, skip=2)
Wrightsville17 = 
  read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2017.csv",
           sep = ",", header = F, skip=2)
Wrightsville18 = 
  read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2018.csv",
           sep = ",", header = F, skip=2)
Wrightsville19 = 
  read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2019.csv",
           sep = ",", header = F, skip=2)
Wrightsville20 =
  read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2020.csv",
           sep = ",", header = F, skip=2)
Wrightsville21 = 
  read.csv("./Data/Raw_Data/WaterTempData/Wrightsville/Wrightsville_2021.csv",
           sep = ",", header = F, skip=2)
```

\newpage
# Rationale and Research Questions
Do climate change indicators, sea level and water temperature have specific
time series trends and do they have a statistically significant relationship 
at three coastal sites in North Carolina: 
Beaufort, Cape Hatteras, and Wrightsville Beach?

To answer this research question, we gathered sea level and water temperature 
data from NOAA. Sea level and water temperature were the chosen parameters to
assess because they are indicators of climate change, and we want 
to analyze the changes occurring on the coast of North Carolina due to this phenomenon. We predicted based on previous studies, that sea level changes have a relationship with global 
warming and thus there will be a correlation with increased water temperature.
Three sites (Beaufort, Cape Hatteras, Wrightsville Beach) were selected because 
those sites are spread out across North Carolina's coast. 


\newpage

# Dataset Information
We are using this repository to upload data from NOAA's Tides&Currents Datasets
for sea level measurements and NOAA's National Data Buoy Center for water
temperature measurements. 

The water temperature data begins on the first day of 2011 and ends on November 31, 2022. 
The raw data for water temperature was in txt file, and those files did not 
clearly transferred into correct data frame. Thus, changed txt files into csv 
files and combined each year's data by rbind. 
The original data had place-holder values of 999 for some of the wtmp
values, so we changed all 999 values into NA and replaced that value into the 
approximate data point using linear interpolation. 
Then we selected columns that we need, which was year, month, day, and water 
temperature. Then calculated daily and monthly averages using group_by and 
summarize functions. We created the processed data and saved them as csv files. 

The sea level data was already in a more simplified format in comparison to the water 
temperature data. The data came off the NOAA website in a monthly collected data 
csv format from years 2011 to 2022. In order to isolate the variables of 
interest as the data set came with other variables such as low range and high 
range tide data, the select function was used concatenating the specific columns 
of interest. Three columns of the original data set were kept, and those were 
the date, the MSL (mean sea level) and MTL (mean tide level). The mutate 
function was then used to create a Station column in order for the sites to be 
differentiated when combined into a large dataset. The data from all three sites 
were joined with the rbind function. The date column in the data frame was calssified as a date and the date was separated into Year and Month columns, and then grouped by those columns for future data exploration and analysis. The final processed data frame was saved as a csv file. 

This project will use a time series analysis to identify seasonal trends and 
changes in sea level and water temperature over the past 12 years using a Mann 
Kendall test. We will then identify if there is a statistical relationship 
between the two parameters using a Kendall correlation test.


```{r, echo= FALSE}
#Data Table Summary

source_1 <- c("Mean Sea Level   ", "   ft", "      NOAA Tide's & Currents") 
source_2<- c("Mean Tide Level   ", "   ft", "      NOAA Tide's & Currents")
source_3 <-c("Daily Temperature   ", "  Â°C", "      NOAA's National Data Buoy Center")

dataset_structure <- data.frame(rbind( source_1, source_2, source_3))

names(dataset_structure) <- NULL  
rownames(dataset_structure) <- NULL  

knitr::kable(dataset_structure,col.names= c("Variable", "Units", "Source"), "simple")


```




```{r}
# Wrangle data to combine the water temperature data for each year into one 
#csv for each site
Beaufort.Water.Temp <-rbind(beaufort11,beaufort12,beaufort13,beaufort14,
                            beaufort15, beaufort16, beaufort17, beaufort18,
                            beaufort19, beaufort20,beaufort21)
names (Beaufort.Water.Temp) <- header

Hatteras.Water.Temp <-rbind(Hatteras11,Hatteras12,Hatteras13,Hatteras14,
                            Hatteras15, Hatteras16, Hatteras17, Hatteras18,
                            Hatteras19, Hatteras20,Hatteras21)
names (Hatteras.Water.Temp) <- header

Wrightsville.Water.Temp <-rbind(Wrightsville11,Wrightsville12,Wrightsville13,
                                Wrightsville14,Wrightsville15, Wrightsville16, 
                                Wrightsville17, Wrightsville18, Wrightsville19,
                                Wrightsville20,Wrightsville21)
names (Wrightsville.Water.Temp) <- header
```

```{r}
#clean-up data that has inconsistent values 

Beaufort.Water.Temp <- Beaufort.Water.Temp %>% 
  mutate (WTMP=ifelse(WTMP ==999,NA,WTMP)) %>% 
  mutate(WTMP = zoo::na.approx(WTMP))

Hatteras.Water.Temp <- Hatteras.Water.Temp %>% 
  mutate (WTMP=ifelse(WTMP ==999,NA,WTMP)) %>% 
  mutate(WTMP = zoo::na.approx(WTMP))

Wrightsville.Water.Temp <- Wrightsville.Water.Temp %>% 
  mutate (WTMP=ifelse(WTMP ==999,NA,WTMP)) %>% 
  mutate(WTMP = zoo::na.approx(WTMP))
```



```{r}
#Wrangle Beaufort water temperature data frames to be averaged by month
beaufort_wtmp <- Beaufort.Water.Temp %>% 
  select("#YY","MM","DD","WTMP") %>% 
  dplyr::rename(Year = "#YY", Month = "MM", Day ="DD") %>% 
  mutate("Date" = make_date(year= Year, month =Month, day = Day))

beaufort_daily_wtmp <-  beaufort_wtmp %>% 
  dplyr::group_by(Year, Month, Day, Date) %>% 
  dplyr::summarise(dailywtmp = mean(WTMP),.groups ='drop') %>% 
  mutate(Station = "Beaufort")

beaufort_monthly_wtmp <- beaufort_wtmp %>% 
  dplyr::group_by(Year, Month) %>% 
  dplyr::summarise( monthlywtmp = mean(WTMP), .groups ='drop') %>% 
  mutate(Station = "Beaufort")%>% 
  mutate("Date" = make_date(year= Year, month = Month))

#Wrangle Hatteras water temperature dataframe to be averaged by month
Hatteras_wtmp <- Hatteras.Water.Temp %>% 
  select("#YY","MM","DD","WTMP") %>% 
  dplyr::rename (Year = "#YY", Month = "MM", Day ="DD")  %>% 
  mutate("Date" = make_date(year= Year, month =Month, day = Day))

Hatteras_daily_wtmp <-  Hatteras_wtmp %>% 
  dplyr::group_by(Year, Month, Day, Date) %>% 
  dplyr::summarise(dailywtmp = mean(WTMP),.groups ='drop') %>% 
  mutate(Station = "Hatteras")

Hatteras_monthly_wtmp <- Hatteras_wtmp %>% 
  dplyr::group_by(Year, Month) %>% 
  dplyr::summarise( monthlywtmp = mean(WTMP), .groups ='drop') %>% 
  mutate(Station = "Hatteras")%>% 
  mutate("Date" = make_date(year= Year, month = Month))


#Wrangle Wrightsville water temperature data frame to be averaged by month

Wrightsville_wtmp <- Wrightsville.Water.Temp %>% 
  select("#YY","MM","DD","WTMP") %>% 
  dplyr::rename (Year = "#YY", Month = "MM", Day ="DD") %>% 
  mutate("Date" = make_date(year= Year, month =Month, day = Day))

Wrightsville_daily_wtmp <-  Wrightsville_wtmp %>% 
  dplyr::group_by(Year, Month, Day, Date) %>% 
  dplyr::summarise(dailywtmp = mean(WTMP),.groups ='drop') %>% 
  mutate(Station = "Wrightsville")

Wrightsville_monthly_wtmp <- Wrightsville_wtmp %>% 
  dplyr::group_by(Year, Month) %>% 
  dplyr::summarise( monthlywtmp = mean(WTMP), .groups ='drop') %>% 
  mutate(Station = "Wrightsville") %>% 
  mutate("Date" = make_date(year= Year, month = Month))

```

```{r}
#combine daily datasets for water temperature 

combine_daily_water_temp <- rbind(beaufort_daily_wtmp, Hatteras_daily_wtmp, 
                                   Wrightsville_daily_wtmp)
write.csv(combine_daily_water_temp, 
          './Data/Processed_Data/combine_daily_water_temp.csv')

#combine monthly datasets for water temperature 

combine_monthly_water_temp <- rbind(beaufort_monthly_wtmp,Hatteras_monthly_wtmp,
                                    Wrightsville_monthly_wtmp)
write.csv(combine_monthly_water_temp,
          './Data/Processed_Data/combine_monthly_water_temp.csv')

```

```{r}
#clean-up sea level datasets
Beaufort_SeaLevel <- Beaufort_SeaLevel %>% select(c(1,6,7)) %>% 
  mutate(Station= "Beaufort")
Hatteras_SeaLevel$Date <- as.Date(Hatteras_SeaLevel$Date, format = "%m/%d/%y")
Hatteras_SeaLevel <- Hatteras_SeaLevel %>% select(c(1,6,7)) %>% 
  mutate(Station= "Hatteras")
Wrightsville_SeaLevel <-Wrightsville_SeaLevel %>% select(c(1,6,7)) %>% 
  mutate(Station= "Wrightsville")

combine_sealevel <- rbind (Beaufort_SeaLevel, Hatteras_SeaLevel,
                           Wrightsville_SeaLevel)
write.csv(combine_sealevel, './Data/Processed_Data/combine_sealevel.csv')

#Prepare necessary data frames for the analyses

combined_sea_level_data <- 
  read.csv("./Data/Processed_Data/combine_sealevel.csv")
#Add month-year column from date
combined_sea_level_data$Date<- as.Date(combined_sea_level_data$Date)
combined_sea_level_data <- combined_sea_level_data %>% mutate(Month=month(Date))%>% 
  mutate(Year=year(Date)) %>% group_by(Year, Month) 

combined_water_temp_data<- 
  read.csv("./Data/Processed_Data/combine_monthly_water_temp.csv")
combined_water_temp_data$Date<-as.yearmon(paste(combined_water_temp_data$Year, 
                                                combined_water_temp_data$Month,
                                                sep="-"), "%Y-%m")
```

\newpage

# Exploratory Analysis 
```{r, echo=FALSE, fig.cap="Sea Level Trend Exploration", fig.align='left', fig.height= 2.5}
#Exploring sea level measurements over the 12 years

sea_level_plot <- ggplot(combined_sea_level_data, aes(x=Date, y=MSL..ft.,
                                                      group = Station))+ 
  geom_line(aes(color = Station)) + geom_smooth(method= "lm", se=FALSE) +
    labs(title = "Mean Sea Levels (2010-2022)",
        y = "Mean Sea Level (ft)", x = "Date (Month-Year)") + 
  scale_x_date(date_breaks="18 months", date_labels ="%b-%y")
print(sea_level_plot)

tide_level<-ggplot(combined_sea_level_data,aes(x=Date,y=MTL..ft.,group=Station))+
  geom_line(aes(color = Station)) + geom_smooth(method= "lm", se=FALSE) +
    labs(title = "Mean Tide Levels (2010-2022)",
        y = "Mean Tide (ft) Level", x = "Date")
print(tide_level)


#Sea Level Measurements for 2011 and 2021

sea_level_2011<-ggplot(combined_sea_level_data,aes(x=Date, y=MSL..ft.,
                                                   group=Station))+
  geom_line(aes(color = Station)) + geom_smooth(method= "lm", se=FALSE) +
    labs(title = "Mean Sea Levels (2011)",
        y = "Mean Sea Level (ft)", x = "Date (Month-Year)") +
  scale_x_date(limits= as.Date(c("2011-01-01", "2011-12-01")), 
               date_breaks="2 months", date_labels ="%b-%y")
print(sea_level_2011)

sea_level_2021 <- ggplot(combined_sea_level_data, aes(x=Date, y=MSL..ft.,
                                                      group = Station))+
  geom_line(aes(color = Station)) + geom_smooth(method= "lm", se=FALSE) +
    labs(title = "Mean Sea Levels (2021)",
        y = "Mean Sea Level (ft)", x = "Date (Month-Year)") +
  scale_x_date(limits= as.Date(c("2021-01-01", "2021-12-01")), 
               date_breaks="2 months", date_labels ="%b-%y")
print(sea_level_2021)

#combined_2011_2021<- grid.arrange(sea_level_2011, sea_level_2021, ncol= 2,
                              #common.ledgend= TRUE)
#print(combined_2011_2021)
```

## Sea level data exploration 
The first plot in the previous r code chunk, sea_level_plot, displays the mean sea level measurements from 2010 to 2022 for each station. There are fluctuations in sea level on a month-to-month basis, but trend lines represent a slight increase in sea level at all three sites since 2010. The tide_level plot shows the mean tide levels for each station, and produced similar results. We noticed fluctuations from month-to-month, but the linear model lines show an increase in tide levels at all the sites.  

The third and fourth graphs display the mean sea levels in 2011 and 2022, respectively sea_level_2011 and sea_level_2021. Both of these graphs indicate increasing mean sea levels over the course of the year for Wrightsville Beach and Beaufort, but decreasing sea levels on Hatteras Island. The trend lines look very similar between the graphs so we are interested in the results produced by the time series analyses for more information.

```{r, echo=FALSE, fig.cap="Water Temperature Trend Exploration", fig.align='left', fig.height= 2.5, fig.width= 5}
#Exploring Trends in Water Temperature

#Daily Water Temperature Measurements for 2011-2022
combined_daily_wtmp_data <-
  read.csv("./Data/Processed_Data/combine_daily_water_temp.csv")
combined_daily_wtmp_data$Date<-as.Date(combined_daily_wtmp_data$Date,
                                       format = "%Y-%m-%d")
daily_wtmp_level_plot <-ggplot(combined_daily_wtmp_data, aes(x =Date,
                                                             y=dailywtmp,
                                                             group= Station))+
  geom_line(aes(color=Station))+
  labs(title = "Daily Water Temperature (2011-2022)",
       y= "Daily Water Temp (Celcius)", x= "Date")+
  scale_x_date(date_breaks = "6 months", date_labels = "%Y-%m-%d")+
  geom_smooth(method= "lm", se=FALSE, aes(color= Station))+
  theme(axis.text.x = element_text(angle=60, hjust=1))
print(daily_wtmp_level_plot)

#Monthly Water Temperature Measurements for 2011-2022
combined_monthly_wtmp_data <- 
  read.csv("./Data/Processed_Data/combine_monthly_water_temp.csv")
combined_monthly_wtmp_data$Date<-as.Date(combined_monthly_wtmp_data$Date,
                                         format = "%Y-%m-%d")
monthly_wtmp_level_plot <-ggplot(combined_monthly_wtmp_data, aes(x =Date,
                                                                 y=monthlywtmp,
                                                              group= Station))+
  geom_line(aes(color=Station))+
  labs(title = "Monthly Water Temperature (2011-2022)",
       y= "Monthly Water Temp (Celcius)", x= "Date")+
  scale_x_date(date_breaks = "6 months", date_labels = "%Y-%m")+
  geom_smooth(method= "lm", se=FALSE, aes(color= Station))+
  theme(axis.text.x = element_text(angle=60, hjust=1))
print(monthly_wtmp_level_plot)

```
## Water temperature data exploration 

A clear seasonal changes is observed in water temperature data for all three 
sites according to the monthly_wtmp_level_plot and daily_wtmp_level_plot graphs. Water temperatures are high in the summer seasons and low in the winter
seasons. There is a overall increase in water temperature in Beaufort and 
Wrightsville, but there was a overall decrease in water temperature in Hatteras. 
The biggest increase in temperature was observed in Beaufort. 

\newpage

# Analysis

## Trend of sea level and water temperature over time and the role of seasonality

```{r, echo=FALSE,fig.cap="Beaufort Sea Level Timeseries", fig.align='left', fig.height= 2.5, warning= FALSE}
#Beaufort Sea Level Time Series
Beaufort <- combined_sea_level_data %>% filter(Station == "Beaufort")

Beaufort.monthly.ts <- ts(Beaufort$MSL..ft.,
    start = c(2010, 1), frequency = 12)

Beaufort_Monthly_Sea_Level <- stl(Beaufort.monthly.ts,
    s.window = "periodic")

plot(Beaufort_Monthly_Sea_Level)

Beaufort_monthly_sea_level_monotonic_trend_analysis<-
  Kendall::SeasonalMannKendall(Beaufort.monthly.ts)

summary(Beaufort_monthly_sea_level_monotonic_trend_analysis)

Beaufort_monthly_sea_level_monotonic_trend_analysis_no_szn<-
  Beaufort.monthly.ts - Beaufort_Monthly_Sea_Level$time.series[,1]

Beaufort_monthly_sea_level_no_szn_trend <- 
  MannKendall(Beaufort_monthly_sea_level_monotonic_trend_analysis_no_szn)

summary(Beaufort_monthly_sea_level_no_szn_trend)

```

### Beaufort Sea Level Time Series

 According to the Beaufort sea level time series analyses and plot, Beaufort_Monthly_Sea_Level, it appears that the trend does seem to gradually increase over time with a couple of fluctuations. Therefore, both a non-seasonal and a seasonal Mann Kendall analysis should be run in order to see clearer quantified trends. Mann Kendall has the ability to detect, accept or reject the presence of monotonic trends. When the seasonal Mann Kendall was ran, the score was 407 with a tau of (0.447) and a 2-sided p-value of (2.94e^-13). This p-value is less than significance level(0.05), so we reject the null hypothesis that there is no monotonic trend. This underscores that the data has a monotonic trend and the tau value(0.447) is statistically significant. The positive value of tau signifies an increasing trend. The seasonal Mann Kendall test only compares data values of the same season. When the seasonal component was removed, the score increased to 4862, with a  tau of (0.413), and an even smaller 2-sided p-value of (2.22e-16). Thus, we reject null hypothesis again, and the positive value of tau signifies an increasing trend. Based on the fact that both tests suggest there is an increasing trend, we can tentatively state that the sea levels of Beaufort are generally increasing over time.
 
```{r,echo=FALSE,fig.cap="Hatteras Sea Level Timeseries", fig.align='left', fig.height= 2.5, warning= FALSE}
#Hatteras Sea Level Time Series
Hatteras <- combined_sea_level_data %>% filter(Station == "Hatteras")

Hatteras.monthly.ts <- ts(Hatteras$MSL..ft.,
    start = c(2010, 1), frequency = 12)

Hatteras_Monthly_Sea_Level <- stl(Hatteras.monthly.ts,
    s.window = "periodic")

plot(Hatteras_Monthly_Sea_Level)

Hatteras_monthly_sea_level_monotonic_trend_analysis <- 
  Kendall::SeasonalMannKendall(Hatteras.monthly.ts)
summary(Hatteras_monthly_sea_level_monotonic_trend_analysis)

Hatteras_monthly_sea_level_monotonic_trend_analysis_no_szn <-
  Hatteras.monthly.ts - Hatteras_Monthly_Sea_Level$time.series[,1]

Hatteras_monthly_sea_level_no_szn_trend <- 
  MannKendall(Hatteras_monthly_sea_level_monotonic_trend_analysis_no_szn)

summary(Hatteras_monthly_sea_level_no_szn_trend)

```

### Hatteras Sea Level Time Series

The Hatteras sea level time series analyses and plot, Hatteras_Monthly_Sea_Level, indicate that the overall data trend in sea level rise is increasing over time. Therefore, both a non-seasonal and a seasonal Mann Kendall analysis should be run in order to see clearer quantified trends. When the seasonal Mann Kendall was ran, the score was (216) with a tau of (0.274) and a 2-sided p-value of (1.86e^-5). This p-value is less than significance level(0.05), so we reject the null hypothesis that there is no monotonic trend. This underscores that the data has a monotonic trend and the tau value(0.274) is statistically significant. The positive value of tau signifies that there is an increasing trend. The seasonal Mann Kendall test only compares data values of the same season. When the seasonal component was removed, the score increased to 2806, with a  tau of (0.273), and an even smaller 2-sided p-value of (1.31e-6). The positive value of tau signifies an increasing trend. Based on the fact that both tests suggest there is an increasing trend, we can tentatively state that the sea levels of Hatteras are generally increasing over time. 


```{r,echo=FALSE, fig.cap="Wrightsville Sea Level Timeseries", fig.align='left', fig.height= 2.5, warning=FALSE}
#Wrightsville Sea Level Time Series
Wrightsville <- combined_sea_level_data %>% filter(Station == "Wrightsville")

Wrightsville.monthly.ts <- ts(Wrightsville$MSL..ft.,
    start = c(2010, 1), frequency = 12)

Wrightsville_Monthly_Sea_Level <- stl(Wrightsville.monthly.ts,
    s.window = "periodic")

plot(Wrightsville_Monthly_Sea_Level)

Wrightsville_monthly_sea_level_monotonic_trend_analysis <- 
  Kendall::SeasonalMannKendall(Wrightsville.monthly.ts)

summary(Wrightsville_monthly_sea_level_monotonic_trend_analysis)


Wrightsville_monthly_sea_level_monotonic_trend_analysis_no_szn <- 
  Wrightsville.monthly.ts - Wrightsville_Monthly_Sea_Level$time.series[,1]

Wrightsville_monthly_sea_level_no_szn_trend <- MannKendall(Wrightsville_monthly_sea_level_monotonic_trend_analysis_no_szn)

summary(Wrightsville_monthly_sea_level_no_szn_trend)
```

### Wrightsville Sea Level Time Series

According to the Wrightsville sea level time series analyses and plot, Wrightsville_Monthly_Sea_Level, it appears that the trend of sea level seems to be gradually increasing over time with a couple of fluctuations. When the seasonal Mann Kendall was ran, the score was 175 with a tau of (0.242) and 2-sided p-value of (0.0002). The p-value of (0.0002) is less than significance level(0.05), so we reject null hypothesis that there is no monotonic trend. Therefore, the data has a monotonic trend. The positive value of tau signifies an increasing trend. The seasonal Mann Kendall test only compares data values of the same season. When the seasonal component was removed, the score increased to 2824, with a  tau of (0.299), and an even smaller 2-sided p-value of (2.38e-7). The positive value of tau signifies an increasing trend. Based on the fact that both tests suggest there is an increasing trend, we can tentatively state that the sea levels of Beaufort are generally increasing over time. 

```{r,echo=FALSE, fig.cap="Beaufort Water Temperature Timeseries", fig.align='left', fig.height= 2.5, warning=FALSE}
#Beaufort Water Temperature Time Series
Beaufort_water_temp_filter <- combined_water_temp_data %>% 
  filter(Station == "Beaufort")

Beaufort.temp.monthly.ts <- ts(Beaufort_water_temp_filter$monthlywtmp,
    start = c(2011, 1), frequency = 12)


Beaufort_Monthly_WaterTemp <- stl(Beaufort.temp.monthly.ts,
    s.window = "periodic")

plot(Beaufort_Monthly_WaterTemp)

Beaufort_monthly_wtmp_monotonic_trend_analysis <-
  Kendall::SeasonalMannKendall(Beaufort.temp.monthly.ts)
summary(Beaufort_monthly_wtmp_monotonic_trend_analysis)

Beaufort_monthly_wtmp_monotonic_trend_analysis_no_szn <- 
  Beaufort.temp.monthly.ts - Beaufort_Monthly_WaterTemp$time.series[,1]

Beaufort_monthly_wtmp_no_szn_trend <- 
  MannKendall(Beaufort_monthly_wtmp_monotonic_trend_analysis_no_szn)

summary(Beaufort_monthly_wtmp_no_szn_trend)
```

### Beaufort Water Temperature Time Series 

The Beaufort water temperature time series plot, Beaufort_Monthly_WaterTemp, suggests an overall increasing trend in water temperature over time. The seasonal Mann Kendall test resulted in a score of 190, a tau value of (0.288) and p-value of (1.96 e-5). This p-value is less than significance level(0.05), so we reject the null hypothesis that there is no monotonic trend. This suggests that a monotonic trend can be accepted and it shows a gradual increase in water temperature over time as tau is positive. Removal of seasonality resulted in a score of 1972, tau of (0.228), and less, but still statistically significant 2-sided pvalue of (0.0001) demonstrating that the removal of seasonality still highlights a monotonic trend in water temperature at the Beaufort site. Therefore we can tentatively say that water temperature is generally increasing over time at Beaufort. 

```{r,echo=FALSE, fig.cap="Hatteras Water Temperature Timeseries", fig.align='left', fig.height= 2.5, warning=FALSE}
#Hatteras Water Temperature Time Series

Hatteras_water_temp_filter <- combined_water_temp_data %>% 
  filter(Station == "Hatteras")

Hatteras.temp.monthly.ts <- ts(Hatteras_water_temp_filter$monthlywtmp,
    start = c(2011, 1), frequency = 12)


Hatteras_Monthly_WaterTemp <- stl(Hatteras.temp.monthly.ts,
    s.window = "periodic")

plot(Hatteras_Monthly_WaterTemp)

Hatteras_monthly_wtmp_monotonic_trend_analysis <-
  Kendall::SeasonalMannKendall(Hatteras.temp.monthly.ts)
summary(Hatteras_monthly_wtmp_monotonic_trend_analysis)

Hatteras_monthly_wtmp_monotonic_trend_analysis_no_szn <-
  Hatteras.temp.monthly.ts - Hatteras_Monthly_WaterTemp$time.series[,1]

Hatteras_monthly_wtmp_no_szn_trend <- 
  MannKendall(Hatteras_monthly_wtmp_monotonic_trend_analysis_no_szn)

summary(Hatteras_monthly_wtmp_no_szn_trend)

```

### Hatteras Water Temperature Time Series 

The Hatteras water temperature time series analyses and plot, Hatteras_Monthly_WaterTemp, suggest a relatively random distribution of water temperature over time. The seasonal Mann Kendall test resulted in a score of 10, a tau value of (0.0152) and p-value of (0.82). A p-value of 0.82 is greater than significance level(0.05), so we accept our null hypothesis that there is not a monotonic trend present. Removal of seasonality resulted in a score of -54, tau of (-0.00625), and also, a non-statistically significant 2-sided pvalue of (0.92) demonstrating that the removal of seasonality also rejects the presence of a monotonic trend in water temperature at the Hatteras site. Thus, there is no uni-direction increase or decrease in water temperature over time at Hatteras. 

```{r,echo=FALSE, fig.cap="Wrightsville Water Temperature Timeseries", fig.align='left', fig.height= 2.5, warning=FALSE}
#Wrightsville Water Temperature Time Series
Wrightsville_water_temp_filter <- combined_water_temp_data %>% 
  filter(Station == "Wrightsville")

Wrightsville.temp.monthly.ts <- ts(Wrightsville_water_temp_filter$monthlywtmp,
    start = c(2011, 1), frequency = 12)


Wrightsville_Monthly_WaterTemp <- stl(Wrightsville.temp.monthly.ts,
    s.window = "periodic")

plot(Wrightsville_Monthly_WaterTemp)

Wrightsville_monthly_wtmp_monotonic_trend_analysis <-
  Kendall::SeasonalMannKendall(Wrightsville.temp.monthly.ts)
summary(Wrightsville_monthly_wtmp_monotonic_trend_analysis)

Wrightsville_monthly_wtmp_monotonic_trend_analysis_no_szn <- 
  Wrightsville.temp.monthly.ts - Wrightsville_Monthly_WaterTemp$time.series[,1]

Wrightsville_monthly_wtmp_no_szn_trend <- 
  MannKendall(Wrightsville_monthly_wtmp_monotonic_trend_analysis_no_szn)

summary(Wrightsville_monthly_wtmp_no_szn_trend)

```

### Wrightsville Water Temperature Time Series 

The Wrightsville water temperature time series plot, Wrightsville_Monthly_WaterTemp, and analyses suggest a relatively uniform, mildly fluctuating distribution of water temperature over time. The seasonal Mann Kendall test resulted in a score of 4, a tau value of (0.006) and p-value of (0.92). Since the p value is greater than significance level(0.05), we accept our null hypothesis that there is not a monotonic trend present. Removal of seasonality resulted in a score of 100, tau of (0.116), and also, a non-statistically significant 2-sided pvalue of (0.84) demonstrating that the removal of seasonality also rejects the presence of a monotonic trend in water temperature at the Hatteras site. Thus, there is no monotonic trend or unidirectional increasing or decreasing in water temperature observed at this site over time. 

## Testing stastically significant relationship between sea level and water temperature

```{r, warning= FALSE}
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=30), tidy=TRUE)

#Correlation Test Between Sea Level and Water Temperature

#Check normality of data
shapiro.test(combined_sea_level_data$MSL..ft.)
shapiro.test(combined_water_temp_data$monthlywtmp)
#The data is non-normal

#Complete a correlation test
combined.sea.level.correlation.edits<-
  combined_sea_level_data[-c(1,2,3,4,5,6,7,8,9,10,11,12,
                             145,146,147,148,149,150,151,
                             152,153,154,155,156,157,158,
                            159,160,161,162,290,291,292,
                            293,294,295,296,297,298,299,300,
                            301,427,428,429,430,431,432,433,
                            434,435,436),]
combined.sea.level.correlation.final <-
  combined.sea.level.correlation.edits[-c(427,428,429,430,
                                          431,432,433,434,435,436),]
combined.water.temp.correlation.edits<-
  combined_water_temp_data[-c(152,163,164,262,263,273,
                              279,294,359,360,361,362),]

Correlation.kendall<- 
  cor.test(combined.sea.level.correlation.edits$MSL..ft., 
           combined.water.temp.correlation.edits$monthlywtmp, method = "kendall")
Correlation.kendall

correlation.combined<- data.frame(combined.sea.level.correlation.edits[,3],
                                  combined.water.temp.correlation.edits[,4])
names(correlation.combined) <- c("MSL", "WTMP")
cor(correlation.combined)

```

### Correlation Test Between Sea Level and Water Temperature

According to the Kendall's rank correlation test for sea level and water temperature measurements, Correlation.kendall, the p-value is (5.949e-08) which is smaller than the significance level of 0.05. This means that we reject the null hypothesis that there is a statistically significant relationship between sea level and water temperature. Therefore, the tau value (0.1853611) is statistically significant, which measures a weak positive correlation between the two parameters. This means that there is a slight correlation that indicates when one value increases, the other will increase. 

A simple correlation test between the two variables (correlation.combined) finds a slightly stronger relationship with a correlation coefficient of (0.216857). This test also indicated a slightly positive correlation between sea level and water temperature at the three sites.

## Question 1: 
How have sea level trends and water temperature trends changed over time and 
how has seasonality played role at three coastal North Carolina sites: 
Beaufort,Hatteras, Wrightsville?

## Question 2: 
Is there a stastically significant relationship between sea level and 
water temperature?


\newpage
# Summary and Conclusions

From the time series analysis, we observed an increasing trend present
in sea level measurements for all three sites. Beaufort, with seasonality considered (Mann-Kandall; tau=0.447, p < 2.94e^-13) and without seasonality considered (Mann-Kandall; tau=0.413, p < 2.22e^-16), had statistically significant tau values and demonstrated an upward trend in sea level. In Hatteras, with seasonality considered (Mann-Kandall; tau=0.274, p < 1.86e^-5) and 
without seasonality considered (Mann-Kandall; tau=0.273, p < 1.31e^-6) had statistically significant tau values and demonstrated an upward trend in sea level.
In Wrightsville, with seasonality considered (Mann-Kandall; tau=0.242, p < 0.0002) and without seasonality considered (Mann-Kandall; tau=0.299, p < 2.38e-7), had statistically significant tau values and demonstrated an upward trend in sea level.

However, monotonic increase of water temperature over time was only observed in Beaufort. Beaufort, with seasonality considered (Mann-Kandall; tau=0.288, p < 1.96e^-5) and without seasonality considered (Mann-Kandall; tau=0.228, p < 0.0001), had statistically significant tau values and demonstrated an upward trend in water temperature. In Hatteras, with seasonality considered (Mann-Kandall; tau=0.0152, p < 0.82 and 
without seasonality considered (Mann-Kandall; tau=-0.00625, p < 0.92), had tau values that were not statistically significant. In Wrightsville, with seasonality considered (Mann-Kandall; tau=0.006, p < 0.92) and without seasonality considered (Mann-Kandall; tau=0.116, p < 0.84), had tau values that are not statisitcally significant.
Sea level has been increasing over all three sites, while only Beaufort has had increasing water temperature over time. Seasonality did not play a significant role at three sites in North Carolina. 

The Kandall's rank correlation test produced a p-value of (5.949e-08), thus a
statistically significant value of tau (0.1853611) indicates a weak positive correlation between sea level and water temperature. This indicates that when there is an increase in sea level, 
there will be an increase of water temperature and vice versa.


\newpage

# References
US DOC/NOAA/NWS/NDBC > National Data Buoy Center (1971). Meteorological and oceanographic data collected from the National Data Buoy Center Coastal-Marine Automated Network (C-MAN) and moored (weather) buoys. Standard Meteorological Data, Historical Data. NOAA National Centers for Environmental Information. Dataset. https://www.ncei.noaa.gov/archive/accession/NDBC-CMANWx. Accessed December 1, 2022.

US DOC/NOAA/NWS/NDBC > Tides & Currents (1982). High and Low Water Conditions. Water Level and Water Temperature Data. NOAA National Centers for Environmental Information. Dataset. https://tidesandcurrents.noaa.gov/map/index.html?region=North%20Carolina. Accessed November 26, 2022.
